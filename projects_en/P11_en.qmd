---
title: "Bike lanes in Buenos Aires City"
description: "Created for Day 26 (Transport) of the [#30daymapchallenge](https://30daymapchallenge.com/), bike lane connectivity in Buenos Aires City."
date: "2025-11-26"
lang: en
categories: [30 day map challenge, Interactive map, Urban planning]
image: ../images/P11_cover.png
format:
  html:
    code-fold: true 
---
****
## Project Overview

:::{.text-justify}
lorem ipsum
:::

## Data Sources and Tools

* Bike lanes and EcoBici stations: [IDECABA](https://idecaba.buenosaires.gob.ar/)
* Basemap: [Argenmap by National Geography Institute of Argentina](https://www.ign.gob.ar/AreaServicios/Argenmap/Introduccion)

****
* Made with ![](../images/QGIS.png){width=1em style="vertical-align: middle;"}[GIS](https://qgis.org/project/overview/) 3.22.4-Białowieża

## Interactive map
```{r}
#| echo: true
#| code-summary: "Click to view code"
#| warning: false
#| message: false

library(sf)
library(leaflet)
library(dplyr)

sf_use_s2(FALSE)
folder_path <- "../vectors"

load_layer <- function(filename) {
  full_path <- file.path(folder_path, filename)
  if (file.exists(full_path)) {
    return(st_read(full_path, quiet = TRUE) %>% st_zm())
  }
  return(NULL)
}

merged_lines <- load_layer("merged_single.geojson")
ecobici      <- load_layer("ecobici.geojson")
puntos_ruteo <- load_layer("ptruteo.geojson")

if (!is.null(ecobici)) ecobici <- st_cast(ecobici, "POINT")
if (!is.null(puntos_ruteo)) puntos_ruteo <- st_cast(puntos_ruteo, "POINT")

my_colors <- c(
  "Bike lane"            = "#1b9e77",
  "One-way bike lane"    = "#7570b3",
  "Suggested bike lanes" = "#d95f02",
  "Suggested routing"    = "tomato", 
  "Current routing"      = "black"
)

if (!is.null(merged_lines)) {
  lines_split <- split(merged_lines, merged_lines$gna)
} else {
  lines_split <- list()
}

map <- leaflet() %>%
  setView(lng = -58.44, lat = -34.61, zoom = 12) %>%
  addTiles(
    urlTemplate = "[https://wms.ign.gob.ar/geoserver/gwc/service/tms/1.0.0/capabaseargenmap@EPSG%3A3857@png/](https://wms.ign.gob.ar/geoserver/gwc/service/tms/1.0.0/capabaseargenmap@EPSG%3A3857@png/){z}/{x}/{-y}.png",
    attribution = "Argenmap - IGN Argentina",
    options = tileOptions(tms = TRUE)
  ) %>%
  addProviderTiles(providers$CartoDB.Positron)

# 6. ADD LINES
for (cat_name in names(lines_split)) {
  col <- ifelse(cat_name %in% names(my_colors), my_colors[cat_name], "#555555")
  
  map <- map %>%
    addPolylines(
      data = lines_split[[cat_name]],
      color = col,
      weight = 2, opacity = 1,
      group = cat_name, 
      popup = ~gna
    )
}

# 7. PREPARE & ADD POINTS
if (!is.null(puntos_ruteo)) {
  parque_points <- filter(puntos_ruteo, nam == "Parque de la Memoria")
  other_stops   <- filter(puntos_ruteo, nam != "Parque de la Memoria")
} else {
  parque_points <- NULL; other_stops <- NULL
}

# A. Standard Stops
if (!is.null(other_stops) && nrow(other_stops) > 0) {
  map <- map %>% addCircleMarkers(
    data = other_stops, radius = 4, 
    fillColor = "#faff39", fillOpacity = 0.8,
    stroke = TRUE, color = "#e6bc26", weight = 1.5,
    group = "Routing end points"
  )
}

# B. Parque de la Memoria
if (!is.null(parque_points) && nrow(parque_points) > 0) {
  map <- map %>% addCircleMarkers(
    data = parque_points, radius = 6, 
    fillColor = "darkorange", fillOpacity = 1,
    stroke = TRUE, color = "tomato", weight = 2,
    group = "Starting routing point"
  )
}

# C. EcoBici
if (!is.null(ecobici)) {
  map <- map %>% addCircleMarkers(
    data = ecobici, radius = 2, 
    fillColor = "#fd7da3", fillOpacity = 0.8,
    stroke = TRUE, color = "#cb6598", weight = 0.3, 
    group = "EcoBici Stations"
  )
}

# 8. DEFINE CUSTOM ORDER (The Fix)
desired_order <- c(
  "Starting routing point",
  "Routing end points",
  "Current routing",
  "Suggested routing",
  "EcoBici Stations",
  "Bike lane",
  "One-way bike lane",
  "Suggested bike lanes"
)

# Collect all group names that actually exist in the data we just plotted
existing_groups <- c(names(lines_split), "Routing end points", "Starting routing point", "EcoBici Stations")

# Intersect matches 'desired_order' against 'existing_groups'
# This keeps ONLY the groups that exist, but enforces YOUR specific order
final_groups <- intersect(desired_order, existing_groups)

map %>%
  addLayersControl(
    overlayGroups = final_groups, # <--- CHANGED THIS from 'all_groups'
    options = layersControlOptions(collapsed = FALSE)
  )
```

## The final map for Day 26

::: {.text-center}
![](../images/P11_map1.png){width=100% class="lightbox"}

![](../images/P11_map2.png){width=100% class="lightbox"}
:::

